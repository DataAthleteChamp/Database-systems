--zadanie 1
--tworzenie tabel

CREATE TABLE KOTY (
    PSEUDO VARCHAR2(15) CONSTRAINT KOT_PK PRIMARY KEY,
    PLEC CHAR(1) CONSTRAINT KOT_PLEC_CHECK CHECK(PLEC IN SET('K', 'M')) CONSTRAINT KOT_PLEC_NN NOT NULL,
    DATA_WSTAPIENIA DATE CONSTRAINT NOT NULL, 
    PRZYDZIAL_MYSZY NUMBER(3) CONSTRAINT PRZYDZIAL_MIN_CHECK CHECK(PRZYDZIAL_MYSZY >=0),
    PSEUDO_SZEFA VARCHAR2(15) REFERENCES KOTY(PSEUDO),
    NR_BANDY NUMBER(2),
    NAZWA_FUNKCJI VARCHAR2(15) REFERENCES FUNKCJE(NAZWA_FUNKCJI)
);

CREATE TABLE MYSZY (
    NR_MYSZY NUMBER(3) CONSTRAINT MYSZY_PK PRIMARY KEY,
    WAGA NUMBER(1) CONSTRAINT MYSZY_WAGA_CHECK CHECK(0 < WAGA < 10) CONSTRAINT MYSZY_WAGA_NN NOT NULL,
    DLUGOSC NUMBER(1) CONSTRAINT MYSZY_DLUGOSC_CHECK CHECK(0< DLUGOSC < 5) CONSTRAINT MYSZY_DLUGOSC_NN NOT NULL,
    DATA_UPOLOWANIA DATE CONSTRAINT MYSZY_UPOLOWANIA_NN NOT NULL,
    DATA_WYDANIA DATE CONSTRAINT MYSZY_WYDANIA_NN NOT NULL,
    PSEUDO_LAPACZA VARCHAR2(15) CONSTRAINT MYSZY_LAPACZ_NN NOT NULL CONSTRAINT MYSZY_LAPACZ_FK REFERENCES KOTY(PSEUDO),
    PSEUDO_ZJADACZA VARCHAR2(15) CONSTRAINT MYSZY_ZJADACZ_FK REFERENCES KOTY(PSEUDO),
    CONSTRAINT MYSZY_DATA_CHECK CHECK(DATA_WYDANIA>=DATA_UPOLOWANIA)
);

CREATE TABLE BANDY (
    NR_BANDY NUMBER(6) CONSTRAINT BANDY_PK PRIMARY KEY,
    TEREN VARCHAR2(15) CONSTRAINT BANDY_TEREN_NN NOT NULL,
    NAZWA VARCHAR2(15) CONSTRAINT BANDY_NAZWA_NN NOT NULL,
    SZEF_BANDY VARCHAR2(15) CONSTRAINT BANDY_SZEF_FK REFERENCES KOTY(PSEUDO)
);

CREATE TABLE WROGOWIE (
    IMIE VARCHAR2(15) CONSTRAINT WROGOWIE_IMIE_PK PRIMARY KEY,
    GATUNEK VARCHAR2(15),
    STOPIEN_WROGOSCI NUMBER(2) CONSTRAINT WROGOWIE_WROGOSC_NN NOT NULL CONSTRAINT WROGOWIE_WROGOSC_CHECK CHECK(STOPIEN_WROGOSCI BETWEEN 1 AND 10),
);

CREATE TABLE LAPOWKI (
    LAPOWKA VARCHAR2(15) CONSTRAINT LAPOWKI_LAPOWKA_PK PRIMARY KEY
);

CREATE TABLE FUNKCJE (
    NAZWA_FUNKCJI VARCHAR2(15) CONSTRAINT FUNKCJE_NAZWA_PK PRIMARY KEY,
    MIN_MYSZY NUMBER(3) CONSTRAINT FUNKCJE_MIN_NN NOT NULL,
    MAX_MYSZY NUMBER(3) CONSTRAINT FUNKCJE_MAX_NN NOT NULL,
    CONSTRAINT FUNKCJE_MIN_MAX_CHECK CHECK (MIN_MYSZY <= MAX_MYSZY)
);

CREATE TABLE INCYDENTY (
    DATA_INCYDENTU DATE CONSTRAINT INCYDENTY_DATA_NN NOT NULL,
    OPIS VARCHAR2(30) CONSTRAINT INCYDENTY_OPIS_NN NOT NULL,
    PSEUDO_KOTA VARCHAR2(15) CONSTRAINT INCYDENTY_KOT_NN NOT NULL CONSTRAINT INCYDENTY_KOT_FK REFERENCES KOTY(PSEUDO),
    IMIE VARCHAR2(15) CONSTRAINT INCYDENTY_WROG_NN NOT NULL CONSTRAINT INCYDENTY_KOT_FK REFERENCES WROGOWIE(IMIE)
);

CREATE TABLE LAPOWKI_WROGOW (
    IMIE VARCHAR2(15) CONSTRAINT LW_IMIE_FK REFERENCES WROGOWIE(IMIE),
    LAPOWKA VARCHAR2(30) CONSTRAINT LW_LAPOWKA_FK REFERENCES LAPOWKI(LAPOWKA),
    CONSTRAINT LW_PK PRIMARY KEY(IMIE, LAPOWKA)

--zadanie 2 
--wpisywanie do tabel

INSERT INTO KOTY (PSEUDO, PLEC, DATA_WSTAPIENIA, PRZYDZIAL_MYSZY, PSEUDO_SZEFA, NR_BANDY, NAZWA_FUNKCJI)
VALUES ('Kot1', 'M', '2022-01-01', 5, 'Kot2', 1, 'Funkcja1'),
       ('Kot2', 'K', '2022-02-01', 8, 'Kot1', 2, 'Funkcja2'),
       ('Kot3', 'M', '2022-03-01', 12, 'Kot2', 1, 'Funkcja1'),
       ('Kot4', 'K', '2022-04-01', 15, 'Kot1', 2, 'Funkcja2'),
       ('Kot5', 'M', '2022-05-01', 6, 'Kot2', 1, 'Funkcja1'),
       ('Kot6', 'K', '2022-06-01', 9, 'Kot1', 2, 'Funkcja2'),
       ('Kot7', 'M', '2022-07-01', 11, 'Kot2', 1, 'Funkcja1'),
       ('Kot8', 'K', '2022-08-01', 14, 'Kot1', 2, 'Funkcja2'),
       ('Kot9', 'M', '2022-09-01', 7, 'Kot2', 1, 'Funkcja1'),
       ('Kot10', 'K', '2022-10-01', 10, 'Kot1', 2, 'Funkcja2');

INSERT INTO MYSZY (NR_MYSZY, WAGA, DLUGOSC, DATA_UPOLOWANIA, DATA_WYDANIA, PSEUDO_LAPACZA, PSEUDO_ZJADACZA)
VALUES (1, 3, 2, '2022-01-01', '2022-01-02', 'Kot1', 'Kot2'),
       (2, 4, 2, '2022-01-03', '2022-01-04', 'Kot2', 'Kot3'),
       (3, 5, 3, '2022-01-05', '2022-01-06', 'Kot3', 'Kot4'),
       (4, 6, 3, '2022-01-07', '2022-01-08', 'Kot4', 'Kot5'),
       (5, 2, 1, '2022-01-09', '2022-01-10', 'Kot5', 'Kot6'),
       (6, 4, 2, '2022-01-11', '2022-01-12', 'Kot6', 'Kot7'),
       (7, 6, 3, '2022-01-13', '2022-01-14', 'Kot7', 'Kot8'),
       (8, 1, 1, '2022-01-15', '2022-01-16', 'Kot8', 'Kot9'),
       (9, 2, 1, '2022-01-17', '2022-01-18', 'Kot9', 'Kot10'),
       (10, 3, 2, '2022-01-19', '2022-01-20', 'Kot10', 'Kot1');

INSERT INTO BANDY (NR_BANDY, TEREN, NAZWA, SZEF_BANDY)
VALUES (1, 'Las', 'Banda1', 'Kot1'),
       (2, 'Polana', 'Banda2', 'Kot5');

INSERT INTO WROGOWIE (IMIE, GATUNEK, STOPIEN_WROGOSCI)
VALUES ('Wrog1', 'Pies', 8),
       ('Wrog2', 'Lis', 7),
       ('Wrog3', 'Niedźwiedź', 9);

INSERT INTO LAPOWKI (LAPOWKA)
VALUES ('Lapowka1'),
       ('Lapowka2'),
       ('Lapowka3');

INSERT INTO FUNKCJE (NAZWA_FUNKCJI, MIN_MYSZY, MAX_MYSZY)
VALUES ('Funkcja1', 3, 7),
       ('Funkcja2', 5, 10);


--zadanie 3
--zapytania select


--1. Problem: Wyszukanie informacji o kotach, których pseudonim zaczyna się na literę "K"

SELECT PSEUDO, PLEC, DATA_WSTAPIENIA, PRZYDZIAL_MYSZY, PSEUDO_SZEFA, NR_BANDY, NAZWA_FUNKCJI
FROM KOTY
WHERE PSEUDO LIKE 'K%';

--2.Problem: Wyszukanie informacji o myszach złapanych przez kota o pseudonimie "Kot1"

SELECT NR_MYSZY, WAGA, DLUGOSC, DATA_UPOLOWANIA, DATA_WYDANIA, PSEUDO_LAPACZA, PSEUDO_ZJADACZA
FROM MYSZY
WHERE PSEUDO_LAPACZA = 'Kot1';

--3. Problem: Wyszukanie informacji o kotach, które są szefami band

SELECT K.PSEUDO, K.PLEC, K.DATA_WSTAPIENIA, K.PRZYDZIAL_MYSZY, K.PSEUDO_SZEFA, K.NR_BANDY, K.NAZWA_FUNKCJI, B.NAZWA
FROM KOTY K
JOIN BANDY B ON K.NR_BANDY = B.NR_BANDY AND K.PSEUDO = B.SZEF_BANDY;

--4.Problem: Wyszukanie informacji o myszach, które zostały złapane przez koty z bandy o numerze "1"

SELECT M.NR_MYSZY, M.WAGA, M.DLUGOSC, M.DATA_UPOLOWANIA, M.DATA_WYDANIA, M.PSEUDO_LAPACZA, M.PSEUDO_ZJADACZA
FROM MYSZY M
JOIN KOTY K ON K.PSEUDO = M.PSEUDO_LAPACZA
WHERE K.NR_BANDY = 1;

--5.Problem: Wyszukanie informacji o kotach, które złapały więcej niż 5 myszy

SELECT PSEUDO, PLEC, DATA_WSTAPIENIA, PRZYDZIAL_MYSZY, PSEUDO_SZEFA, NR_BANDY, NAZWA_FUNKCJI
FROM KOTY
WHERE PRZYDZIAL_MYSZY > 5;

--6. Problem: Wyszukanie informacji o myszach, które zostały złapane przez kota o pseudonimie "Kot1" i zjedzone przez kota o pseudonimie "Kot2"

SELECT NR_MYSZY, WAGA, DLUGOSC, DATA_UPOLOWANIA, DATA_WYDANIA, PSEUDO_LAPACZA, PSEUDO_ZJADACZA
FROM MYSZY
WHERE PSEUDO_LAPACZA = 'Kot1' AND PSEUDO_ZJADACZA = 'Kot2';

--7.Problem: Wyszukanie informacji o bandach, których szefem jest kot o pseudonimie "Kot1" oraz ile myszy złapał ten kot

SELECT B.NR_BANDY, B.TEREN, B.NAZWA, B.SZEF_BANDY, K.PRZYDZIAL_MYSZY
FROM BANDY B
JOIN KOTY K ON B.SZEF_BANDY = K.PSEUDO
WHERE B.SZEF_BANDY = 'Kot1';

--8. Problem: Wyszukanie informacji o kotach, które złapały myszy w dniu '2022-01-01'

SELECT K.PSEUDO, K.PLEC, K.DATA_WSTAPIENIA, K.PRZYDZIAL_MYSZY, K.PSEUDO_SZEFA, K.NR_BANDY, K.NAZWA_FUNKCJI
FROM KOTY K
JOIN MYSZY M ON K.PSEUDO = M.PSEUDO_LAPACZA
WHERE M.DATA_UPOLOWANIA = '2022-01-01';

--9. Problem: Wyszukanie informacji o myszach, które zostały złapane przez kota o pseudonimie "Kot1" lub zjedzone przez kota o pseudonimie "Kot2"

SELECT NR_MYSZY, WAGA, DLUGOSC, DATA_UPOLOWANIA, DATA_WYDANIA, PSEUDO_LAPACZA, PSEUDO_ZJADACZA
FROM MYSZY
WHERE PSEUDO_LAPACZA = 'Kot1' OR PSEUDO_ZJADACZA = 'Kot2';

--10. Problem: Wyszukanie informacji o bandach, których szefem jest kot o pseudonimie "

SELECT B.NR_BANDY, B.TEREN, B.NAZWA, B.SZEF_BANDY, SUM(K.PRZYDZIAL_MYSZY) as SUMA_MYSZY
FROM BANDY B
JOIN KOTY K ON B.SZEF_BANDY = K.PSEUDO
GROUP BY B.NR_BANDY, B.TEREN, B.NAZWA, B.SZEF_BANDY
HAVING B.SZEF_BANDY = 'Kot1';

